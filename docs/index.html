<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Leaflet Map</title>

    <!-- import styling -->
    <link rel="stylesheet" href="leaflet.css"/>

    <!-- custom styling -->
    <style type="text/css">
      body{
        margin: 0;
        padding: 0;
      }
      #map {
        width: 100vw;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <!-- element that contains map -->
    <div id="map"></div>

    <!-- import packages -->
    <script src="script/leaflet.js"></script>

    <!-- load data -->
    <script src="data/axesofreconstruction_crs84.js"></script>
    <script src="data/featuretraces_crs84.js"></script>
    <script src="data/profileextents_crs84.js"></script>
    <script src="data/mapextents_crs84.js"></script>

    <!-- custom code for the leaflet map -->
    <script>
        // Map Object
        const map = L.map('map', {
            center: [36.85324009154614, 10.323104630306315],
            zoom: 18,
            zoomControl: true,
            maxZoom: 28,
            minZoom: 18
            });
        
        // Basemap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors' }).addTo(map);
        
        // Vector Layers
        // var layer;
        // function highlightFeature(e) {
        //   var layer = e.target;
        //   // console.log(e.target)

        //   layer.setStyle({
        //     weight: 5,
        //     color: '#666',
        //     fillOpacity: 0.7
        //   });
        // };
        // function resetHighlight(e, geoJsonLayer) {
        //   // console.log(e.target)
        //   // console.log(layer)
        //   // var layer = e.target;
        //   geoJsonLayer.resetStyle(e.target);
        // }

        // function onEachFeature(feature, layer, geoJsonLayer) {
        //   layer.on({
        //     mouseover: highlightFeature,
        //     mouseout: function (e) { resetHighlight(e, geoJsonLayer) }
        //   })
        // }
        // layer = L.geoJSON(featureTraces, {
        //   style: function () {
        //     return {
        //       color: 'blue'
        //     }
        //   },
        //   onEachFeature: onEachFeature
        // }).addTo(map)

        // Styles
        var highlightStyle = {
          weight: 5,
          color: '#666',
          fillOpacity: 0.7
        }
        function highlightFeature(e) {
          var layer = e.target;

          layer.setStyle(highlightStyle);

          // I'm not sure if this is necessary, but both GPT and
          // Stack Overflow (https://gis.stackexchange.com/q/227377)
          // suggested it
          if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
            layer.bringToFront();
          }
        }

        function onEachFeature(feature, layer, geoJsonLayer) {
          // Note the distinction between `layer` and `geoJsonLayer` - only the
          // former has the resetStyle() method
          layer.on({
            mouseover: highlightFeature,
            mouseout: function(e) {
              geoJsonLayer.resetStyle(e.target);
            }
          });
        }

        function addGeoJsonLayer(geoJsonData, map) {
          var geoJsonLayer = L.geoJSON(geoJsonData, {
            style: function () {
              return { color: 'blue' }; // Default style
            }
          }).addTo(map);
          console.log(geoJsonLayer)

          // Now set the onEachFeature option with the correct reference to geoJsonLayer
          geoJsonLayer.eachLayer(function(layer) {
            onEachFeature(layer.feature, layer, geoJsonLayer);
          });

          return geoJsonLayer; // Return the layer in case you need to use it elsewhere
        }

        // When you add a new GeoJSON layer, get the layer instance
        var myGeoJsonLayer = addGeoJsonLayer(featureTraces, map);


        // layer = L.geoJSON(featureTraces, {
        //   style: function () {
        //       return {
        //           color: 'red'
        //       }
        //   },
        //   onEachFeature: function (feature, layer) {
        //     layer.on('mouseover', function () {
        //       this.setStyle({
        //         color: 'green'
        //       });
        //     });
        //     layer.on('mouseout', function () {
        //       layer.resetStyle(this);
        //     });
        //   }
        // }).addTo(map)
        // map.addLayer(layer)

        // L.geoJSON(features).addTo(map)
        // L.geoJSON(profiles).addTo(map)
        // L.geoJSON(axes).addTo(map)

        // When user clicks on a feature (of any layer, show the metadata)


    </script>
    </body>
</html>
